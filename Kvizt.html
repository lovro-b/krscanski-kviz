<!DOCTYPE html>
<html lang="sl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Krščanski Kviz - Modern Filtri</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://cdn.jsdelivr.net/npm/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #3f37c9;
      --accent: #4895ef;
      --light: #f8f9fa;
      --dark: #212529;
      --gray: #6c757d;
      --white: #ffffff;
      --shadow: 0 4px 20px rgba(0,0,0,0.08);
      --favorite: #e74c3c;

      --difficulty-1: #22C55E;
      --difficulty-2: #EAB308;
      --difficulty-3: #F97316;
      --difficulty-4: #DC2626;
      --difficulty-5: #7C3AED;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background: #f5f7ff; color: var(--dark); line-height: 1.6; }
    .container { max-width: 1400px; margin: 0 auto; padding: 2rem; display: grid; grid-template-columns: 280px 1fr; gap: 2rem; }
    .filter-sidebar { background: var(--white); border-radius: 16px; padding: 1.5rem; box-shadow: var(--shadow); height: fit-content; position: sticky; top: 2rem; }
    .filter-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; padding-bottom: 1rem; border-bottom: 1px solid rgba(0,0,0,0.05); }
    .filter-title { font-size: 1.25rem; font-weight: 600; color: var(--dark); }
    .reset-btn { background: none; border: none; color: var(--accent); font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 0.25rem; }
    .filter-group { margin-bottom: 1.75rem; }
    .filter-group-title { font-size: 0.95rem; font-weight: 600; margin-bottom: 0.75rem; color: var(--gray); display: flex; align-items: center; justify-content: space-between; }
    .filter-options { display: flex; flex-direction: column; gap: 0.5rem; }
    .filter-option { display: flex; align-items: center; padding: 0.5rem 0.75rem; border-radius: 8px; cursor: pointer; transition: background 0.2s; }
    .filter-option:hover { background: rgba(67, 97, 238, 0.05); }
    .filter-option.active { background: rgba(67, 97, 238, 0.1); }
    .filter-option input { margin-right: 0.75rem; accent-color: var(--primary); }
    .filter-option label { flex: 1; cursor: pointer; font-size: 0.95rem; }
    .filter-count { background: rgba(0,0,0,0.05); color: var(--gray); padding: 0.25rem 0.5rem; border-radius: 12px; font-size: 0.8rem; font-weight: 500; }
    .main-content { display: flex; flex-direction: column; gap: 1.5rem; }
    .search-bar { background: var(--white); border-radius: 12px; padding: 0.75rem 1.25rem; box-shadow: var(--shadow); display: flex; align-items: center; }
    .search-bar input { flex: 1; border: none; outline: none; font-size: 1rem; padding: 0.5rem; background: transparent; }
    .search-bar i { color: var(--gray); margin-right: 0.75rem; }
    .results-header { display: flex; justify-content: space-between; align-items: center; }
    .results-count { font-size: 0.95rem; color: var(--gray); }
    .sort-options { display: flex; gap: 0.5rem; }
    .sort-btn { background: var(--white); border: none; padding: 0.5rem 1rem; border-radius: 8px; font-size: 0.9rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; box-shadow: var(--shadow); }
    .sort-btn.active { background: var(--primary); color: white; }
    .questions-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
    .question-card { background: var(--white); border-radius: 12px; padding: 1.5rem; box-shadow: var(--shadow); transition: transform 0.2s, box-shadow 0.2s; position: relative; border-top: 4px solid var(--primary); }
    .question-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.1); }
    .question-card.difficulty-1 { border-top-color: var(--difficulty-1); }
    .question-card.difficulty-2 { border-top-color: var(--difficulty-2); }
    .question-card.difficulty-3 { border-top-color: var(--difficulty-3); }
    .question-card.difficulty-4 { border-top-color: var(--difficulty-4); }
    .question-card.difficulty-5 { border-top-color: var(--difficulty-5); }
    .question-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .question-difficulty { font-size: 0.8rem; font-weight: 600; padding: 0.25rem 0.75rem; border-radius: 12px; color: white; }
    .difficulty-badge-1 { background: var(--difficulty-1); }
    .difficulty-badge-2 { background: var(--difficulty-2); }
    .difficulty-badge-3 { background: var(--difficulty-3); }
    .difficulty-badge-4 { background: var(--difficulty-4); }
    .difficulty-badge-5 { background: var(--difficulty-5); }
    .favorite-btn { background: none; border: none; font-size: 1.25rem; cursor: pointer; color: #ddd; transition: all 0.3s ease; padding: 0.25rem; border-radius: 50%; }
    .favorite-btn:hover { color: var(--favorite); transform: scale(1.1); }
    .favorite-btn.active { color: var(--favorite); }
    .favorite-btn.active:hover { color: #c0392b; }
    .question-text { font-size: 1.1rem; margin-bottom: 1.25rem; line-height: 1.5; }
    .answer { color: var(--secondary); font-weight: 600; padding-top: 1rem; border-top: 1px dashed rgba(0,0,0,0.1); margin-top: 1rem; }
    .question-categories { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 1.25rem; }
    .category-tag { background: rgba(67, 97, 238, 0.1); color: var(--primary); font-size: 0.75rem; padding: 0.35rem 0.75rem; border-radius: 12px; display: flex; align-items: center; gap: 0.25rem; }
    .no-results { grid-column: 1 / -1; text-align: center; padding: 3rem; color: var(--gray); }
    .favorites-section { margin-top: 2rem; padding-top: 2rem; border-top: 2px solid rgba(0,0,0,0.1); }
    .favorites-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem; }
    .favorites-title { font-size: 1.5rem; font-weight: 600; color: var(--dark); }
    .show-favorites-btn { background: var(--favorite); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; transition: background-color 0.3s; }
    .show-favorites-btn:hover { background: #c0392b; }
    .favorites-count { background: rgba(255,255,255,0.2); color: white; padding: 0.25rem 0.75rem; border-radius: 12px; font-size: 0.9rem; margin-left: 0.5rem; }

    /* ---- MODAL ZA IZVOZ ---- */
    .export-modal { position: fixed; inset: 0; background: rgba(0,0,0,.45); display: none; align-items: center; justify-content: center; z-index: 999; }
    .export-modal-content { background: var(--white); padding: 2rem; border-radius: 12px; width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: .75rem; }
    .export-modal-content h3 { margin-bottom: .5rem; font-size: 1.1rem; }
    .export-modal-content label { display: flex; align-items: center; gap: .5rem; font-size: .95rem; }
    .export-buttons { margin-top: 1rem; display: flex; gap: 1rem; justify-content: flex-end; }
    .export-buttons button { padding: .5rem 1.2rem; border: none; border-radius: 8px; cursor: pointer; font-size: .95rem; }
    #exportCancel { background: var(--gray); color: #fff; }
    #exportDownload { background: var(--primary); color: #fff; }

    @media (max-width: 992px) {
      .container { grid-template-columns: 1fr; }
      .filter-sidebar { position: static; }
    }
  </style>
  <base target="_blank">
</head>
<body>
  <div class="container">
    <!-- SIDEBAR -->
    <aside class="filter-sidebar">
      <div class="filter-header">
        <h2 class="filter-title">Filtri</h2>
        <button class="reset-btn"><i class="fas fa-undo"></i> Ponastavi</button>
      </div>

      <!-- Difficulty -->
      <div class="filter-group">
        <div class="filter-group-title"><span>Težavnost</span></div>
        <div class="filter-options" id="difficulty-filters">
          <div class="filter-option active">
            <input type="checkbox" id="difficulty-all" checked>
            <label for="difficulty-all">Vse težavnosti</label>
            <span class="filter-count" id="count-difficulty-all">0</span>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="difficulty-1">
            <label for="difficulty-1">1 - Zelo lahka</label>
            <span class="filter-count" id="count-difficulty-1">0</span>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="difficulty-2">
            <label for="difficulty-2">2 - Lahka</label>
            <span class="filter-count" id="count-difficulty-2">0</span>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="difficulty-3">
            <label for="difficulty-3">3 - Srednja</label>
            <span class="filter-count" id="count-difficulty-3">0</span>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="difficulty-4">
            <label for="difficulty-4">4 - Težka</label>
            <span class="filter-count" id="count-difficulty-4">0</span>
          </div>
          <div class="filter-option">
            <input type="checkbox" id="difficulty-5">
            <label for="difficulty-5">5 - Zelo težka</label>
            <span class="filter-count" id="count-difficulty-5">0</span>
          </div>
        </div>
      </div>

      <!-- Categories -->
      <div class="filter-group">
        <div class="filter-group-title"><span>Kategorije</span></div>
        <div class="filter-options" id="category-filters">
          <div class="filter-option active">
            <input type="checkbox" id="category-all" checked>
            <label for="category-all">Vse kategorije</label>
            <span class="filter-count" id="count-category-all">0</span>
          </div>
          <!-- Dinamično -->
        </div>
      </div>
    </aside>

    <!-- MAIN -->
    <main class="main-content">
      <div class="search-bar">
        <i class="fas fa-search"></i>
        <input type="text" id="search-input" placeholder="Išči med vprašanji in odgovori...">
      </div>

      <div class="results-header">
        <div class="results-count">Najdenih: <span id="results-count">0</span> vprašanj</div>
        <div class="sort-options">
          <button class="sort-btn active" data-sort="difficulty"><i class="fas fa-sort-amount-down"></i> Težavnost</button>
          <button class="sort-btn" data-sort="alphabetical"><i class="fas fa-sort-alpha-down"></i> A-Ž</button>
        </div>
      </div>

      <div class="questions-grid" id="questions-container"></div>

      <!-- PRILJUBLJENA -->
      <div class="favorites-section">
        <div class="favorites-header">
          <h2 class="favorites-title">Priljubljena vprašanja</h2>
          <button class="show-favorites-btn" id="show-favorites-btn"><i class="fas fa-heart"></i> Prikaži priljubljene <span class="favorites-count" id="favorites-count">0</span></button>
          <!-- Gumb za izvoz PDF se doda JS -->
        </div>
        <div class="questions-grid" id="favorites-container"></div>
      </div>
    </main>
  </div>

  <!-- MODAL ZA IZVOZ -->
  <div id="exportModal" class="export-modal">
    <div class="export-modal-content">
      <h3>Izberi vsebino PDF-a</h3>
      <label><input type="checkbox" id="expVpr" checked> Vprašanja</label>
      <label><input type="checkbox" id="expOdg" checked> Odgovori</label>
      <label><input type="checkbox" id="expTez"> Težavnost</label>
      <label><input type="checkbox" id="expKat"> Kategorije</label>
      <div class="export-buttons">
        <button id="exportCancel">Prekliči</button>
        <button id="exportDownload">Prenesi PDF</button>
      </div>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const questionsContainer = document.getElementById('questions-container');
      const favoritesContainer = document.getElementById('favorites-container');
      const searchInput = document.getElementById('search-input');
      const resultsCount = document.getElementById('results-count');
      const resetBtn = document.querySelector('.reset-btn');
      const sortButtons = document.querySelectorAll('.sort-btn');
      const showFavoritesBtn = document.getElementById('show-favorites-btn');
      const favoritesCount = document.getElementById('favorites-count');

      let questions = [];
      let allCategories = new Set();
      let favoriteQuestions = new Set();
      let activeFilters = { difficulties: [], categories: [], searchQuery: '', sortBy: 'difficulty' };
      let showOnlyFavorites = false;

      fetch('vprasanja.json')
        .then(r => r.json())
        .then(data => {
          questions = data.map((q, i) => ({ ...q, id: q.id || i + 1 }));
          loadFavorites();
          data.forEach(q => q.kategorije.forEach(k => allCategories.add(k)));
          const sortedCategories = Array.from(allCategories).sort();
          sortedCategories.forEach(cat => {
            const div = document.createElement('div');
            div.className = 'filter-option';
            div.innerHTML = `
              <input type="checkbox" id="category-${cat.replace(/\s+/g, '-')}">
              <label for="category-${cat.replace(/\s+/g, '-')}">${cat}</label>
              <span class="filter-count" id="count-category-${cat.replace(/\s+/g, '-')}">0</span>
            `;
            document.getElementById('category-filters').appendChild(div);
          });
          updateCounters();
          applyFilters();
          displayFavorites();
          setupFilterEvents();
        })
        .catch(err => {
          console.error(err);
          questionsContainer.innerHTML = '<div class="no-results"><i class="fas fa-exclamation-circle" style="font-size:3rem;margin-bottom:1rem;"></i><h3>Napaka pri nalaganju vprašanj</h3><p>Preverite, ali datoteka vprasanja.json obstaja.</p></div>';
        });

      function loadFavorites() {
        const saved = localStorage.getItem('favoriteQuestions');
        if (saved) favoriteQuestions = new Set(JSON.parse(saved));
        updateFavoritesCount();
      }
      function saveFavorites() {
        localStorage.setItem('favoriteQuestions', JSON.stringify([...favoriteQuestions]));
        updateFavoritesCount();
      }
      function updateFavoritesCount() { favoritesCount.textContent = favoriteQuestions.size; }

      function displayQuestions(list) {
        if (!list.length) {
          questionsContainer.innerHTML = '<div class="no-results"><i class="fas fa-search" style="font-size:3rem;margin-bottom:1rem;"></i><h3>Ni ustreznih vprašanj</h3><p>Spremenite iskalne pogoje.</p></div>';
          return;
        }
        questionsContainer.innerHTML = '';
        list.forEach(q => {
          const isFav = favoriteQuestions.has(q.id);
          const card = document.createElement('div');
          card.className = `question-card difficulty-${q.težavnost}`;
          card.innerHTML = `
            <div class="question-header">
              <div class="question-difficulty difficulty-badge-${q.težavnost}">Težavnost: ${q.težavnost}/5</div>
              <button class="favorite-btn ${isFav ? 'active' : ''}"><i class="fas fa-heart"></i></button>
            </div>
            <div class="question-text">${q.vprašanje}</div>
            <div class="answer">${q.odgovor}</div>
            <div class="question-categories">${q.kategorije.map(k => `<div class="category-tag"><i class="fas fa-tag"></i> ${k}</div>`).join('')}</div>
          `;
          card.querySelector('.favorite-btn').addEventListener('click', function () {
            toggleFavorite(q.id);
            this.classList.toggle('active');
            displayFavorites();
          });
          questionsContainer.appendChild(card);
        });
        resultsCount.textContent = list.length;
      }

      function displayFavorites() {
        const favList = questions.filter(q => favoriteQuestions.has(q.id));
        if (!favList.length) {
          favoritesContainer.innerHTML = '<div class="no-results"><i class="fas fa-heart" style="font-size:3rem;margin-bottom:1rem;color:#ddd;"></i><h3>Ni priljubljenih vprašanj</h3><p>Kliknite srček ob vprašanju, da ga dodate.</p></div>';
          return;
        }
        favoritesContainer.innerHTML = '';
        favList.forEach(q => {
          const card = document.createElement('div');
          card.className = `question-card difficulty-${q.težavnost}`;
          card.innerHTML = `
            <div class="question-header">
              <div class="question-difficulty difficulty-badge-${q.težavnost}">Težavnost: ${q.težavnost}/5</div>
              <button class="favorite-btn active"><i class="fas fa-heart"></i></button>
            </div>
            <div class="question-text">${q.vprašanje}</div>
            <div class="answer">${q.odgovor}</div>
            <div class="question-categories">${q.kategorije.map(k => `<div class="category-tag"><i class="fas fa-tag"></i> ${k}</div>`).join('')}</div>
          `;
          card.querySelector('.favorite-btn').addEventListener('click', () => {
            toggleFavorite(q.id);
            displayFavorites();
            applyFilters();
          });
          favoritesContainer.appendChild(card);
        });
      }

      function toggleFavorite(id) {
        favoriteQuestions.has(id) ? favoriteQuestions.delete(id) : favoriteQuestions.add(id);
        saveFavorites();
      }

      function applyFilters() {
        let filtered = questions.filter(q => {
          if (showOnlyFavorites && !favoriteQuestions.has(q.id)) return false;
          if (activeFilters.difficulties.length && !activeFilters.difficulties.includes(q.težavnost)) return false;
          if (activeFilters.categories.length) {
            const has = q.kategorije.some(k => activeFilters.categories.includes(k));
            if (!has) return false;
          }
          if (activeFilters.searchQuery) {
            const query = activeFilters.searchQuery.toLowerCase();
            if (!q.vprašanje.toLowerCase().includes(query) && !q.odgovor.toLowerCase().includes(query)) return false;
          }
          return true;
        });
        if (activeFilters.sortBy === 'difficulty') filtered.sort((a, b) => a.težavnost - b.težavnost);
        if (activeFilters.sortBy === 'alphabetical') filtered.sort((a, b) => a.vprašanje.localeCompare(b.vprašanje, 'sl'));
        displayQuestions(filtered);
      }

      function updateCounters() {
        document.getElementById('count-difficulty-all').textContent = questions.length;
        for (let i = 1; i <= 5; i++) {
          document.getElementById(`count-difficulty-${i}`).textContent = questions.filter(q => q.težavnost === i).length;
        }
        document.getElementById('count-category-all').textContent = questions.length;
        allCategories.forEach(cat => {
          const count = questions.filter(q => q.kategorije.includes(cat)).length;
          document.getElementById(`count-category-${cat.replace(/\s+/g, '-')}`).textContent = count;
        });
      }

      function setupFilterEvents() {
        // difficulty
        document.querySelectorAll('#difficulty-filters input').forEach(cb => {
          cb.addEventListener('change', function () {
            if (this.id === 'difficulty-all') {
              document.querySelectorAll('#difficulty-filters input').forEach(x => x.checked = this.checked);
              activeFilters.difficulties = this.checked ? [] : [1, 2, 3, 4, 5];
            } else {
              const d = parseInt(this.id.split('-')[1]);
              this.checked ? activeFilters.difficulties.push(d) : activeFilters.difficulties = activeFilters.difficulties.filter(x => x !== d);
              const allD = document.querySelectorAll('#difficulty-filters input:not(#difficulty-all)');
              document.getElementById('difficulty-all').checked = Array.from(allD).every(x => x.checked);
            }
            applyFilters();
          });
        });
        // categories
        document.querySelectorAll('#category-filters input').forEach(cb => {
          cb.addEventListener('change', function () {
            if (this.id === 'category-all') {
              document.querySelectorAll('#category-filters input').forEach(x => x.checked = this.checked);
              activeFilters.categories = this.checked ? [] : Array.from(allCategories);
            } else {
              const cat = this.id.replace('category-', '').replace(/-/g, ' ');
              this.checked ? activeFilters.categories.push(cat) : activeFilters.categories = activeFilters.categories.filter(c => c !== cat);
              const allC = document.querySelectorAll('#category-filters input:not(#category-all)');
              document.getElementById('category-all').checked = Array.from(allC).every(x => x.checked);
            }
            applyFilters();
          });
        });
        // search
        searchInput.addEventListener('input', () => {
          activeFilters.searchQuery = searchInput.value.trim().toLowerCase();
          applyFilters();
        });
        // sort
        sortButtons.forEach(btn => {
          btn.addEventListener('click', function () {
            sortButtons.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            activeFilters.sortBy = this.dataset.sort;
            applyFilters();
          });
        });
        // show only favs
        showFavoritesBtn.addEventListener('click', function () {
          showOnlyFavorites = !showOnlyFavorites;
          if (showOnlyFavorites) {
            this.innerHTML = '<i class="fas fa-times"></i> Prikaži vsa vprašanja';
            this.style.background = 'var(--gray)';
          } else {
            this.innerHTML = '<i class="fas fa-heart"></i> Prikaži priljubljene <span class="favorites-count">' + favoriteQuestions.size + '</span>';
            this.style.background = 'var(--favorite)';
          }
          applyFilters();
        });
        // reset
        resetBtn.addEventListener('click', () => {
          document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = true);
          searchInput.value = '';
          activeFilters = { difficulties: [], categories: [], searchQuery: '', sortBy: 'difficulty' };
          sortButtons.forEach(b => b.classList.remove('active'));
          document.querySelector('[data-sort="difficulty"]').classList.add('active');
          showOnlyFavorites = false;
          showFavoritesBtn.innerHTML = '<i class="fas fa-heart"></i> Prikaži priljubljene <span class="favorites-count">' + favoriteQuestions.size + '</span>';
          showFavoritesBtn.style.background = 'var(--favorite)';
          applyFilters();
        });
      }

      // ---------- PDF EXPORT ----------
      const exportModal = document.getElementById('exportModal');
      const exportCancel = document.getElementById('exportCancel');
      const exportDownload = document.getElementById('exportDownload');

      const exportBtn = document.createElement('button');
      exportBtn.className = 'show-favorites-btn';
      exportBtn.innerHTML = '<i class="fas fa-file-pdf"></i> Izvozi priljubljene v PDF';
      exportBtn.style.background = '#c0392b';
      document.querySelector('.favorites-header').appendChild(exportBtn);

      exportBtn.onclick = () => {
        if (!favoriteQuestions.size) return alert('Nimate še priljubljenih vprašanj.');
        exportModal.style.display = 'flex';
      };
      exportCancel.onclick = () => exportModal.style.display = 'none';

      exportDownload.onclick = async () => {
        const opts = {
          vpr: document.getElementById('expVpr').checked,
          odg: document.getElementById('expOdg').checked,
          tez: document.getElementById('expTez').checked,
          kat: document.getElementById('expKat').checked
        };
        if (!opts.vpr && !opts.odg && !opts.tez && !opts.kat) return alert('Izberite vsaj eno možnost.');
        exportModal.style.display = 'none';
        await generatePDF(opts);
      };

      async function generatePDF(opts) {
        const { PDFDocument, rgb } = PDFLib;
        const pdf = await PDFDocument.create();
        const font = await pdf.embedFont(PDFLib.StandardFonts.Helvetica);
        const bold = await pdf.embedFont(PDFLib.StandardFonts.HelveticaBold);
        let page = pdf.addPage();
        const { width, height } = page.getSize();
        const margin = 50;
        let y = height - margin - 20;

        const favQs = questions.filter(q => favoriteQuestions.has(q.id));
        favQs.forEach((q, idx) => {
          if (y < 120) {
            page = pdf.addPage();
            y = height - margin - 20;
          }
          const naslov = `${idx + 1}. ${q.vprašanje}`;
          if (opts.vpr) {
            page.drawText(naslov, { x: margin, y, size: 12, font: bold, color: rgb(0, 0, 0) });
            y -= 18;
          }
          if (opts.odg) {
            page.drawText(`Odgovor: ${q.odgovor}`, { x: margin + 5, y, size: 11, font, color: rgb(0.2, 0.2, 0.2) });
            y -= 16;
          }
          if (opts.tez) {
            page.drawText(`Težavnost: ${q.težavnost}/5`, { x: margin + 5, y, size: 10, font, color: rgb(0.4, 0.4, 0.4) });
            y -= 14;
          }
          if (opts.kat) {
            page.drawText(`Kategorije: ${q.kategorije.join(', ')}`, { x: margin + 5, y, size: 10, font, color: rgb(0.4, 0.4, 0.4) });
            y -= 14;
          }
          y -= 10;
        });

        const bytes = await pdf.save();
        downloadBlob(bytes, 'priljubljena_vprasanja.pdf', 'application/pdf');
      }

      function downloadBlob(data, filename, type) {
        const blob = new Blob([data], { type });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = filename;
        document.body.appendChild(a); a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      }
    });
  </script>
</body>
</html>
 